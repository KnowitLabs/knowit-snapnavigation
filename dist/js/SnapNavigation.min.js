/*! SnapNavigation - v0.9.6 - 2014-05-18
* https://github.com/KnowitLabs/knowit-snapnavigation
* Copyright (c) 2014 Andreas Norman; Licensed MIT */
var snapQuicksearch={searchResultTemplate:null,init:function(){$(".quicksearch-button").on("click",function(a){a.preventDefault(),$(".snap-drawer-right .loading").show(),kitUtils.log("Click quicksearch button"),snapQuicksearch.doQuickSearch($(".snap-drawer-right .searchfield-snap").val())}),$(".snap-drawer-right .searchfield-snap").keydown(function(a){13===a.which&&($(".snap-drawer-right .loading").show(),snapQuicksearch.doQuickSearch($(this).val()),$(this).blur())}),directive={li:{"pageItems <- Items":{"i@class":function(a){return kitUtils.log(a.pageItems.item.Type),"Page"===a.pageItems.item.Type?"fa fa-angle-right":"fa fa-file-o"},"a span":"pageItems.Header","a@href":"pageItems.LinkUrl"}}},searchResultTemplate=$p("#quicksearch-results-list").compile(directive)},doQuickSearch:function(a){$href=$(".quicksearchbar").data("searchurl")+"&q="+a,kitUtils.log($href),$("#quicksearch-button").attr("href",$href),kitUtils.log("start quicksearch"),$jsonurl=$(".quicksearchbar").data("json"),$ajaxCall=$.ajax({url:$jsonurl+"&query="+a,dataType:"json"}),$ajaxCall.done(function(b){kitUtils.log("quicksearch response"),kitUtils.log(b),$foundResults=b.Items.length,$foundResults>0?(kitUtils.log("quicksearch results > 0"),$("#quicksearch-results-list").html(searchResultTemplate(b))):($("div.errormsg p").html('Din sökning på "'+a+'" gav inga träffar.'),$("div.errormsg").show()),$("#quicksearch-results .search-number").html($foundResults),$("#quicksearch-results .search-term").html(a),$(".snap-drawer-right .loading").hide(),$("#quicksearch-results").show(),$.cookie("searchQuery",a)}),$ajaxCall.fail(function(){$("div.errormsg p").html("Something went wrong, please refresh the page and try again."),$("div.errormsg").show()})}},snapNavigation={init:function(){function a(){kitUtils.isMobileBrowser()===!1&&(b.close(),$("html,body").animate({scrollTop:0},0))}var b=new Snap({element:document.getElementById("main-content"),maxPosition:265,minPosition:-265,tapToClose:!0,touchToDrag:!1});$(window).bind("orientationchange",function(){b.close(),$("html,body").animate({scrollTop:0},0)});var c;$(window).resize(function(){clearTimeout(c),c=setTimeout(a,100)}),$("#toggle-sidebar").on("click",function(a){a.preventDefault(),$("body").hasClass("snapjs-left")?b.close("left"):b.open("left")}),b.on("close",function(){$(".searchfield-snap").blur(),$("#top-bar").show()}),b.on("open",function(){$("#top-bar").hide()}),$(".mobile-navigation-list li.haschildren a").click(function(a){kitUtils.log(a.target),$(a.target).is("i")&&($(this).parent().toggleClass("expanded"),$(this).parent().hasClass("expanded")?($(a.target).removeClass("fa-plus"),$(a.target).addClass("fa-minus")):($(a.target).addClass("fa-plus"),$(a.target).removeClass("fa-minus")),a.preventDefault())}),$(".mobile-navigation-list li.haschildren a").on("touchstart",function(a){$(a.target).is("i")?$(a.target).addClass("focus"):$(this).addClass("focus")}),$(".mobile-navigation-list li.haschildren a").on("touchmove",function(){$(".mobile-navigation-list a").removeClass("focus"),$(".mobile-navigation-list i").removeClass("focus")}),$(".mobile-navigation-list li.haschildren a").on("touchend",function(){$(".mobile-navigation-list a").removeClass("focus"),$(".mobile-navigation-list i").removeClass("focus")}),$(".mobile-navigation-list li.haschildren a").on("touchleave",function(){$(".mobile-navigation-list a").removeClass("focus"),$(".mobile-navigation-list i").removeClass("focus")}),$(".mobile-navigation-list li.haschildren a").on("touchcancel",function(){$(".mobile-navigation-list a").removeClass("focus"),$(".mobile-navigation-list i").removeClass("focus")}),$(".snap-overlay").on("click",function(a){b.close(),a.preventDefault()}),$(".snap-overlay").on("touchmove",function(a){b.close(),a.preventDefault()}),$(".snap-overlay").on("touchend",function(a){b.close(),a.preventDefault()}),$(".snap-overlay").on("touchleave",function(a){b.close(),a.preventDefault()}),$(".snap-overlay").on("touchcancel",function(a){b.close(),a.preventDefault()}),$("#toggle-searchbar").on("click",function(a){kitUtils.log("open search"),$.cookie("searchQuery")&&(kitUtils.log($.cookie("searchQuery")),snapQuicksearch.doQuickSearch($.cookie("searchQuery"))),a.preventDefault(),$("body").hasClass("snapjs-right")?b.close("right"):(b.open("right"),$("html,body").animate({scrollTop:0},0))}),$(".snap-drawer .close-menu").on("click",function(a){a.preventDefault(),b.close()})}};